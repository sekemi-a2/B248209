---
title: "The impact of the COVID-19 pandemic on type 2 diabetes medication prescribing patterns across Scotland, and how this varies across deprived areas"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: lumen
    highlight: tango
    code_folding: hide
date: "2025-10-31"
---

## Introduction

Type 2 diabetes is a major public health concern in Scotland, with its prevalence rising by approximately 40% in the last decade (Colhoun & McKnight, 2020). Effective medication management is important for preventing complications and reducing healthcare burden associated with the condition. Prescribing patterns therefore provide valuable insights into population health, but they are sensitive to changes in healthcare access, media influence and wider social conditions.

The COVID-19 pandemic introduced unprecedented disruption to daily life. Lockdowns contributed to lifestyle changes associated with increased metabolic risk, while restricted access to healthcare may have affected diagnosis and routine management, which may have impacted existing socioeconomic disparities. Diabetes prevalence is 80% higher in the most deprived fifth of the population than in the fifth most affluent, and the gap is widening (Colhoun & McKnight, 2020).

This report examines how prescribing of common Type 2 medications changed during the COVID-19 pandemic across Scotland. The aim is to assess whether the pandemic altered prescribing patterns, and whether these changes differed by levels of socioeconomic deprivation.

## Methods

Prescription data were obtained from Public Health Scotland’s Prescriptions in the Community dataset, specifically the “Data by Prescriber Location” records, covering the period from January 2020 to December 2021, were downloaded and saved into a folder designated for consecutive data. Population estimates were downloaded from the National Records of Scotland 2022 census release (Table UV302: General Health, Health Board Area, 2019). Socioeconomic deprivation was assessed using the Scottish Index of Multiple Deprivation (SIMD) 2020v2 data zone lookup file. NHS Scotland health board boundaries were incorporated using publicly available shapefiles to enable spatial analysis and visualisation in prescribing across regions.

The data was then filtered for type 2 diabetes medications including biguanides (metformin), SGLT2 inhibitors (gliflozins), sulphonylureas (gliclazide, glimepiride), DDP-4 inhibitors (gliptins), GLP-1 receptor agonists (glutides), thiazolidinediones (glitazone), with all available formulations. These filtered data were then processed to generate visual summaries and descriptive analyses.

For the purpose of this study, the COVID-19 period is defined as March 2020 to June 2021, covering the introduction of national lockdown measures through to the lifting of major covid restrictions.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor) # cleaning data
library(gt) # to create pretty tables
library(here) # directory structure
library(readxl) # read in excel file
library(sf) # to read in map data
library(plotly) # for interactive plot
library(scales) # to add colour scheme

# Get data from 24-month period from Jan 2020 - Dec 2021
files <- list.files(here("data", "consecutive_data"), pattern = "csv")

consecutive_data <- files %>% 
  map_dfr( ~read_csv(here("data", "consecutive_data", .))) %>% 
  clean_names() # Cleans column names

# Read in SIMD data
deprivation_stats <- read_excel(here("data/SIMD.xlsx"))
```

```{r message=FALSE, warning=FALSE}
# Read in and tidy health board population database
population_data <- read_csv(here("data/general_health_census.csv"), skip = 10) %>% 
  filter(!is.na('All people')) %>%  # Removes NA
  rename(hb_name = "General health",
         hb_population = "All people") %>% 
  select(hb_name, hb_population) %>% 
  filter(!str_detect(hb_population, "Cells")) # Removes rows with text in population (to remove copyright info from data)
```

## Results

The results are structured to show how Type 2 diabetes prescribing changed during and after the COVID-19 pandemic across Scotland. Temporal trends are presented first, followed by comparisons of absolute and percentage changes across Health Boards. A final summary table integrates these measures to illustrate variation across Scotland.

First, to understand the overall pattern of prescribing during the COVID-19 pandemic, monthly prescribing rates from January 2020 to December 2022 were examined for each Health Board. Line plots were generated using free y-scales to account for substantial differences in prescription volume between Health Boards, ensuring that trends within boards were more easily comparable.

### Figure
```{r message=FALSE, warning=FALSE}
# Filter for diabetes medications
diabetes_summary <- consecutive_data %>%
  filter(!is.na(bnf_item_description)) %>% 
  filter(str_detect(bnf_item_description,
                    regex("metformin|gliptin|gliflozin|glutide|glitazone|gliclazide|glimepiride", ignore_case = TRUE))) %>% # Search for common diabetes medications whilst ignoring upper and lower cases
    group_by(paid_date_month, hbt) %>% 
    summarise(paid_quantity = sum(paid_quantity, na.rm = TRUE)) %>% 
    mutate(paid_date_month = ym(paid_date_month)) # Format dates

# Merge all tables together
combined_health_data <- deprivation_stats %>%
  full_join(diabetes_summary, join_by(HBcode == hbt)) %>%
  left_join(population_data, join_by(HBname == hb_name))

# Calculate prescriptions per person
combined_health_data <- combined_health_data %>%
  group_by(HBname, paid_date_month) %>%
  mutate(quantity_per_head = paid_quantity / mean(as.numeric(hb_population))) # Calculate prescriptions per person and change hb_population to numeric value instead of character
```

```{r message=FALSE, warning=FALSE, fig.width=10, fig.height=6}
# Plot diabetes summary table, highlighting COVID-19 period
meds_per_month <- combined_health_data %>% 
  ggplot(aes(x = paid_date_month, y = quantity_per_head)) +
  # Add vertical lines for COVID start and end
  geom_vline(xintercept = as.numeric(ymd("2020-03-01")), 
             linetype = "dashed", colour = "orange") +
  geom_vline(xintercept = as.numeric(ymd("2021-06-01")), 
             linetype = "dashed", colour = "orange") +
  geom_line(colour = "purple") +
  labs(
    title = "Type 2 diabetes medications per person across Scotland NHS Healthboards",
    subtitle = "January 2020 - December 2021 | Orange dashed lines: COVID-19 period (Mar 2020 - Jun 2021)",
    x = "Month",
    y = "Quantity per head") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, hjust=1), 
        plot.title = element_text(face = "bold"))+
  facet_wrap(~HBname, scales = "free_y")

meds_per_month #display result
```

All Health Boards showed a marked decline in prescribing at the onset of COVID-19 in March 2020, followed by gradual recovery. However, there was variation in the number of timing of subsequent troughs during the COVID-19 period, with most experiencing notable dips in early 2021. Overall, prescribing levels increased across all boards when comparing pre- and post- pandemic periods.

To quantify these changes, January 2020 was selected as the pre-COVID baseline baseline and December 2022 as the post-pandemic comparison point. These timepoints reduce the influence of seasonal variation and allow for consistent comparison between more and less deprived areas. Absolute changes between pre-COVID and post-COVID prescribing were calculated and ordered by deprivation rank.

### Figure
```{r message=FALSE, warning=FALSE}
# Create table with pre and post COVID values
key_months_data <- combined_health_data %>% 
  filter(paid_date_month %in% as.Date(c("2020-01-01", "2021-12-01"))) %>% 
  group_by(HBname) %>% 
  mutate(covid_phase = case_when(
    paid_date_month == as.Date("2020-01-01") ~ "pre_covid",
    paid_date_month == as.Date("2021-12-01") ~ "post_covid"))
```

```{r message=FALSE, warning=FALSE}
# Summarise by health board and COVID phase
pre_post_data <- key_months_data %>%
  group_by(HBname, covid_phase) %>% 
  summarise(avg_qph = mean(quantity_per_head, na.rm = TRUE),
            avg_simd = mean(SIMD2020v2_Decile, na.rm = TRUE)) %>%
  pivot_wider(names_from = covid_phase, values_from = avg_qph) %>% # Pivot to get Pre and Post columns for connecting lines
  mutate(percent_change = round(((post_covid - pre_covid)/pre_covid)*100, 2)) %>%
  arrange(desc(avg_simd)) %>% # Rank from least to most deprived
  ungroup() %>% # Before creating a factor so HBname can be arranged in order of avg_simd in graph
  mutate(HBname = factor(HBname, levels = HBname)) # Create factor to preserve order of rows in plot
```

```{r message=FALSE, warning=FALSE, fig.width=8.5, fig.height=6}
# Plot lollipop graph
lollipop_graph <- pre_post_data %>% 
  ggplot() +
  geom_segment(aes(x = HBname, xend = HBname, y = pre_covid, yend = post_covid), 
               color = "grey") +
  geom_point(aes(x = HBname, y = pre_covid,
                 text = round(pre_covid, 2)), # display when graph hovered over
             color = "orange", size = 3) +
  geom_point(aes(x = HBname, y = post_covid,
                 text = round(post_covid, 2)), # display when graph hovered over
             color = "purple", size = 3) +
  coord_flip() +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold")) +
  xlab("Health Boards (least to most deprived)") +
  ylab("Average Quantity Per Head") +
  ggtitle("Change in Type 2 Diabetes Prescribing Pre- and Post-COVID\nHealth Boards Ranked by Deprivaton")

# Convert to interactive graph
lollipop_interactive <- ggplotly(lollipop_graph, tooltip = "text")

lollipop_interactive
```
<p style="text-align: center;"><em>Hover over each point to view corresponding pre- and post-COVID values</em></p>

Figure 3.2 illustrates a clear gradient whereby more deprived Health Boards consistently exhibited higher prescribing levels both before and after COVID-19. Ayrshire and Arran, the most deprived Health Board, recorded the highest post-COVID average quantity per head (4.69). The Western Isles, ranked fourth in deprivation, showed the largest absolute increase (0.86) between pre- and post-COVID periods. In contrast, Grampian and Shetland, the two least deprived Health Boards, had the lowest post-COVID average quantities per head (3.34), with Shetland showing the smallest increase (0.42). This pattern suggests that although prescribing increased across all Health Boards, existing socioeconomic gradients in Type 2 diabetes medication use remained evident.

However, absolute increases are heavily influenced by population size. To assess the severity of change across boards, percentage increases were examined to provide insights into how dramatically prescribing rose relative to pre-COVID levels, independent of baseline prescribing levels.

### Figure
```{r message=FALSE, warning=FALSE}
# Load NHS Health board Shapefile
NHS_healthboards <- suppressMessages(st_read(here("data/Week6_NHS_HealthBoards_2019.shp"), quiet = TRUE)) # Reads in file and hides message

# Join spatial data with other health data
summary_map <- NHS_healthboards %>%
  full_join(pre_post_data, by = join_by(HBName == HBname)) %>% 
  rename(HBname = HBName) # Change column name for consistency
```

```{r message=FALSE, warning=FALSE}
# Plot percentage change map
plot_map <- summary_map %>% 
  ggplot() +
  geom_sf(aes(fill = percent_change, text = paste0("Health Board: ", HBname, "\n", round(percent_change,2), "%")), size = 0.3) +
  scale_fill_viridis_c(option = "plasma", 
                       name = "% Change") +
  labs(
    title = "Percentage Change in Average Type 2 Diabetes Prescriptions Per Head\n Pre-COVID → Post-COVID by NHS Health Boards"
  ) +
  theme_minimal() +
  theme(legend.position = "right", plot.title = element_text(face = "bold"))

interactive_map <- ggplotly(plot_map, tooltip = "text")

interactive_map
```
<p style="text-align: center;"><em>Hover over map to view Health Board name and corresponding percentage change</em></p>

When examining percentage changes (Figure 3.3), the Western Isles showed the largest proportional rise at 29.00%, despite not having the highest baseline prescribing levels. Other Health Boards with relatively high increases included Lothian (24.28%), Highland (23.48%), Grampian (22.70%), and Tayside (21.06%), indicating substantial post-COVID growth across a mix of both urban and rural regions. In contrast, Shetland had the smallest proportional increase at 14.44%, with Ayrshire and Arran and Forth Valley showing more moderate rises of 18.79% and 20.79%, respectively.

Several Health Boards in the South of Scotland also demonstrated comparatively lower percentage changes. Dumfries and Galloway increased by 17.98%, while the Borders showed a rise of 20.00%, both noticeably smaller than the increases observed in more deprived central belt Health Boards such as Greater Glasgow and Clyde (19.25%) and Lanarkshire (17.80%).

To integrate these findings, a summary table presented below, showing each Health Board’s deprivation rank, baseline prescribing, and the observed absolute and percentage increases, allowing direct comparison across boards.

### Figure
```{r message=FALSE, warning=FALSE}
# Create summary table to be printed
ranked_table <- pre_post_data %>% 
  arrange(avg_simd) %>% 
  mutate(Rank = row_number(),
         absolute_change = round(post_covid - pre_covid, 2)) %>%
  select(c(Rank, HBname, pre_covid, absolute_change, percent_change)) # Select columns in order to be displayed
```

```{r}
# Create gt table
ranked_table %>%
  gt() %>%
  cols_label(
    Rank = html("Rank<br>(Most to Least Deprived)"), # HTML break for cleaner layout
    HBname = "NHS Health Board",
    pre_covid = html("Pre-COVID Level<br>(per head)"),
    absolute_change = "Absolute Increase",
    percent_change = "Percentage Increase (%)"
  ) %>%
  fmt_number(
    columns = c(pre_covid),
    decimals = 2) %>%
  tab_header(
    title = " NHS Health Boards by Percentage Increase in Type 2 Diabetes Prescriptions",
    subtitle = "Comparing pre-COVID (Jan 2020) to post-COVID (Dec 2021)"
  ) %>% 
  # Colour scale for Absolute Increase
  data_color(
    columns = absolute_change,
    method = "numeric",
    palette = "Oranges"
  ) %>%
  # Colour scale for Percentage Increase
  data_color(
    columns = percent_change,
    method = "numeric",
    palette = "Purples"
  )
```
## Discussion

Analysis of Type 2 diabetes prescribing during the COVID-19 pandemic reveals temporal fluctuations aligned with national lockdowns. For instance, early 2021 saw a sharp decline in prescriptions corresponding to the third lockdown, likely reflecting reduced face-to-face appointments, interruptions to routine monitoring, and shifts in clinical priorities that limited opportunities for medication review and initiation (Figure 3.1). Once restrictions eased, most Health Boards experienced a rebound in prescribing, indicating a catch-up effect in routine diabetes care (Figures 3.1 and 3.2).

The recovery, however, was uneven across regions. While Ayrshire and Arran consistently had the highest prescribing levels and Grampian and Shetland the lowest, post-COVID prescribing generally exceeded pre-pandemic levels across all Health Boards, suggesting the restoration of services without significantly worsening existing inequalities (Figure 3.2). Yet, the size of the proportional increases varied by deprivation status: more deprived or mixed-deprivation areas such as the Western Isles and Highland, showed notably larger percentage increases, indicating these regions may have experienced more delayed or deferred care during the pandemic (Figure 3.3). In contrast, less deprived areas, particularly Shetland, had smaller proportional changes, implying relatively consistent access to services or faster recovery.

Combining absolute and proportional changes highlights regional trajectories. The Western Isles, for example, recorded both the largest absolute and proportional increases, even though it is not the most deprived board, underscoring the influence of local factors beyond socioeconomic status (Figure 3.4). Across other boards, substantial variation persisted regardless of deprivation, suggesting that geography, alongside other factors played critical roles in shaping recovery patterns. Together, these trends indicate that while socioeconomic deprivation remains an important determinant of prescribing levels, post-pandemic recovery was also shaped by broader structural and operational factors within each Health Board (Figures 3.3 and 3.4).

### Limitations 

There are several limitations to this study. Regional differences in prescribing patterns may be influenced by confounders such as local health policies, medication availability, or access to healthcare settings. Additionally, only two time points are compared, so fluctuations during the pandemic are not captured. Finally, average SIMD scores showed little variation, requiring deprivation to be ranked rather than categorised into low- to high-deprived groups.

### Next Steps

Future studies should examine multiple time points throughout the pandemic to capture fluctuations and provide a more detailed understanding of prescribing trends. Additionally, to better understand variation across deprived areas, deprivation should be assessed at a smaller geographic scale than Health Boards. Achieving this would require population data from the Scottish Census at finer geographic levels. Lastly, studies would need to explore other factors other than deprivation, that may influence type 2 diabetes medication prescription patterns, and identify how each variable affects the different regions.

## Conclusion

The COVID-19 pandemic caused notable disruptions to Type 2 diabetes prescribing in Scotland, with steep declines during lockdowns followed by a partial recovery once restrictions eased. Post-pandemic increases were observed across all Health Boards, yet the extent of recovery differed, with regions such as the Western Isles, Highland, and Lothian showing particularly pronounced rises. While longstanding socioeconomic disparities in medication use were still apparent, the recovery trajectory was also shaped by other factors. These findings suggest that, although deprivation influenced prescribing patterns, a range of other factors that need to be explored, contributed to the uneven and regionally varied impact of the pandemic on routine diabetes care.

## References
1. National Records of Scotland (2022). Scottish Census. Scottish Census Web Portal. https://www.scotlandscensus.gov.uk/webapi/jsf/tableView/tableView.xhtml

2. Public Health Scotland (2025). Prescriptions in the Community. NHS Scotland Open Data. https://www.opendata.nhs.scot/dataset/prescriptions-in-the-community

3. Colhoun, H.M. & McKnight, J. (2020). Diabetes in Scotland: a rising tide. The Lancet Diabetes & Endocrinology 8, 769-770. https://doi.org/10.1016/S2213-8587(20)30124-8

4. Scottish Government (2020). Scottish Index of Multiple Deprivation 2020v2 data zone lookup file. Scottish Government Supporting Documents. https://www.gov.scot/collections/scottish-index-of-multiple-deprivation-2020/#supportingdocuments

5. UK Government (2025). NHS Health Boards Scotland. Data.gov.uk. https://www.data.gov.uk/dataset/27d0fe5f-79bb-4116-aec9-a8e565ff756a/nhs-health-boards-scotland

6. Williams R, Walker J, Smith K, Brown L (2023). The effect of the COVID-19 pandemic on HbA1c testing: prioritization of high risk cases and impact of social deprivation. Diabetes Therapy 14, 1231-1245. https://doi.org/10.1007/s13300-023-01380-x


```{r}
sessionInfo() # Display R and package versions for reproducibility


